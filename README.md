# AI Code Patcher - 功能 & 使用說明 (v11)

## 1. 簡介

AI Code Patcher 是一款專為開發者設計的純前端程式碼比對與修正工具。它的核心目標是解決在與大型語言模型（LLM，如 ChatGPT）協作時，手動合併 AI 提供的部分程式碼修改所帶來的困擾與風險。

本工具提供一個**安全**（所有操作皆在您的瀏覽器本機完成，程式碼絕不外洩）、**直觀**、**高效**的介面，讓您能輕鬆比對原始碼與 AI 的修正建議，並一鍵安全地應用這些修改。

## 2. 核心功能

本工具的核心設計圍繞著以下幾個強大功能：

#### 2.1 智慧補丁模式 (Smart Patch Mode)
這是本工具最關鍵的功能。當 AI 只提供一小段修正後的函式或程式碼片段時，啟用此模式，工具會：
- **自動尋找最佳匹配**: 在您的「原始碼」中，自動尋找與 AI 提供的片段最相似的區塊。
- **局部應用差異**: 只在找到的區塊內進行差異比對，其餘未相關的程式碼將保持不變，避免誤刪。
- **處理全新程式碼**: 如果在原始碼中找不到任何相似區塊，工具會將其視為全新程式碼，並附加在檔案末尾。

#### 2.2 Hunk 顯示與上下文高亮 (Hunk Display & Context Highlighting)
為了讓您能清晰地理解修改發生的位置，結果預覽區採用了專業開發工具（如 Git）的 Hunk 顯示模型：
- **上下文關聯**: 以每一處變更（紅色/綠色行）為中心，自動向上和向下抓取 3 行未變動的程式碼作為「上下文」，並以**柔和的灰色背景**高亮顯示。
- **聚焦修改**: 這讓您能一眼看出修改發生在哪個函式或 CSS 規則內。
- **省略無關程式碼**: 如果兩處修改相隔太遠，中間會用 `...` 分隔符省略，讓您能專注於有關聯的修改區塊。

#### 2.3 行內差異高亮 (Inline Diff Highlighting)
當一行程式碼僅有部分字詞被修改時，本工具不僅僅是標記整行刪除、整行新增，而是會：
- 在同一行內，用**更深的紅色/綠色背景**精準地標示出被修改的**具體單詞或字符**。

#### 2.4 其他主要功能
- **並排差異比對**: 直觀的雙欄佈局，方便貼上程式碼。
- **語法高亮**: 編輯區與結果區皆支援程式碼語法高亮，提升可讀性。
- **自動比對**: 啟用後，在您停止輸入 500 毫秒後會自動觸發比對，無需手動點擊。
- **差異導航**: 使用 `<` 和 `>` 按鈕，可快速在多個修改區塊 (Hunk) 之間跳轉。
- **安全與隱私**: 100% 純前端，您的程式碼永遠不會離開您的電腦。

## 3. 使用教學

1.  **開啟工具**: 將 `ai-code-patcher-v11.html` 檔案用瀏覽器打開。
2.  **貼上程式碼**:
    - 在左側的「**1. 原始碼**」區域，貼上您完整、未修改的程式碼。
    - 在右側的「**2. AI 修正建議**」區域，貼上 AI 給您的修正後程式碼（可以是完整檔案，也可以是部分片段）。
3.  **選擇模式與比對**:
    - **智慧補丁模式 (預設開啟)**: 推薦用於 AI 提供**部分程式碼**的場景。
    - **標準模式** (關閉「智慧補丁」開關): 適用於您有兩個**完整檔案**需要比對的場景。
    - **自動比對 (預設開啟)**: 無需操作，在您貼上程式碼後稍待片刻，下方的「結果預覽」區會自動更新。若關閉此功能，則需手動點擊「手動比對」按鈕。
4.  **審閱結果**:
    - 在「**3. 結果預覽**」區查看比對結果。
    - <span style="background-color: #f8d7da; color: #721c24;">紅色背景</span>：代表從原始碼中被**刪除**的行。
    - <span style="background-color: #d4edda; color: #155724;">綠色背景</span>：代表在修正建議中被**新增**的行。
    - <span style="background-color: #e2e3e5; color: #383d41;">灰色背景</span>：代表與修改相關的**上下文**行，幫助您定位。
    - **深紅/深綠**: 代表行內被修改的具體字詞。
5.  **導航與確認**:
    - 使用結果預覽區右上角的 `<` `>` 按鈕，在所有修改區塊之間快速跳轉，逐一確認。
6.  **獲取結果**:
    - **✅ 應用修改**: 將預覽結果直接更新回左側的「原始碼」區域。
    - **📋 複製結果**: 將完整的、已修正的程式碼複製到剪貼簿。
    - **💾 下載檔案**: 將修正後的程式碼保存為一個 `.txt` 檔案。

## 4. 範例

#### 範例 1：AI 修正部分函式 (使用「智慧補丁模式」)

假設您的原始碼有一個計算總價的函式，但稅率計算錯誤。

- **原始碼 (`original.js`)**:
```javascript
function processOrder(items) {
  // ... 其他程式碼
  console.log("正在處理訂單...");
}

function calculateTotal(price, quantity) {
  const subtotal = price * quantity;
  const tax = subtotal * 0.08; // 錯誤的稅率
  return subtotal + tax;
}

function sendConfirmationEmail(user) {
  // ... 其他程式碼
  console.log("正在發送郵件...");
}
```

- **AI 修正建議 (僅提供修正後的函式)**:
```javascript
function calculateTotal(price, quantity) {
  const subtotal = price * quantity;
  const taxRate = 0.05; // 正確的稅率
  const tax = subtotal * taxRate;
  console.log(`計算稅額: ${tax}`); // 新增日誌
  return subtotal + tax;
}
```

- **結果預覽 (啟用「智慧補丁」和「上下文高亮」後)**:
  工具會自動定位到 `calculateTotal` 函式並顯示如下的 Hunk：

```diff
  ...
  console.log("正在處理訂單...");
}

- function calculateTotal(price, quantity) {
-   const subtotal = price * quantity;
-   const tax = subtotal * 0.08; // 錯誤的稅率
-   return subtotal + tax;
- }
+ function calculateTotal(price, quantity) {
+   const subtotal = price * quantity;
+   const taxRate = 0.05; // 正確的稅率
+   const tax = subtotal * taxRate;
+   console.log(`計算稅額: ${tax}`); // 新增日誌
+   return subtotal + tax;
+ }

function sendConfirmationEmail(user) {
  // ... 其他程式碼
  ...
```
> **說明**: 您可以看到，工具不僅正確替換了函式，還將函式上下的空行和下一個函式的宣告作為「上下文」高亮（灰色背景），讓您清楚地知道修改的範圍。

#### 範例 2：修改一行中的某個值 (展示「行內差異高亮」)

- **原始碼**:
```css
.button {
  background-color: #007bff;
  padding: 10px 15px;
}
```

- **AI 修正建議**:
```css
.button {
  background-color: #dc3545;
  padding: 10px 20px;
}
```

- **結果預覽**:
```diff
  ...
- .button {
-   background-color: #007bff;
-   padding: 10px 15px;
- }
+ .button {
+   background-color: #dc3545;
+   padding: 10px 20px;
+ }
  ...
```
> **說明**: 在這個預覽中，您不僅會看到整行變紅/變綠，在 `background-color` 和 `padding` 這兩行，`#007bff` 和 `15px` 會被**更深的紅色**高亮，而 `#dc3545` 和 `20px` 會被**更深的綠色**高亮，讓您一眼就看到具體是哪個值被改變了。

## 5. 介面元素說明

- **手動比對**: 強制執行一次差異比對。
- **智慧補丁 (開關)**: 開啟後，會自動在原始碼中尋找匹配片段；關閉後，則進行標準的全檔案比對。
- **自動比對 (開關)**: 開啟後，停止輸入即自動比對；關閉後，需手動點擊比對按鈕。
- **全部清空**: 清空所有輸入框和結果區。
- **上傳檔案**: 點擊標題旁的按鈕，可從本地上傳程式碼檔案。
- **`<` / `>`**: 在結果預覽區的修改點之間向前/向後導航。
- **✅ 應用修改**: 將結果區的內容覆蓋回原始碼區。
- **📋 複製結果**: 複製修正後的完整程式碼。
- **💾 下載檔案**: 將修正後的程式碼下載為檔案。D
